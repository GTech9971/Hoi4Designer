# HOI4 航空機設計アプリケーション - 実装ロードマップ

## ✅ 完了済み機能

### 基本システム
- [x] メイン設計画面（プリセット名入力、モジュールスロット、ステータス表示）
- [x] モジュール選択画面（詳細表示、ステータス差分表示）
- [x] 武器タイプ選択画面（機関銃、魚雷、爆弾、防衛砲塔）
- [x] ステータス計算システム（変更前後の差分表示機能付き）

### 実装済みモジュール
- [x] **エンジン**：エンジンI〜IV（推力、速度、機動性に影響）
- [x] **機関銃**：10種類（大砲I×1/×2、重機関銃×2/×4、軽機関銃×2/×4、対戦車砲等）
- [x] **爆弾**：7種類（徹甲爆弾層、仕込み爆弾、大型爆弾層、ロケットレール等）
- [x] **防衛砲塔**：3種類（対方式、重機関銃式、軽機関銃式の防御砲塔）
- [x] **特殊装備**：8種類（空対空レーダー、爆撃照準器、無線航行等）
- [x] **魚雷**：3種類（軽魚雷、軽魚雷の安価な代替、小型版）
- [x] **電装系**：8種類（空対空レーダーI/II、爆撃照準器I/II、無線航行I/II）
- [x] **装甲**：2種類（基本装甲、重装甲）
- [x] **燃料タンク**：2種類（落下タンク、自己酸素供給タンク）

### 推力vs重量システム
- [x] **推力計算**: エンジンの推力値に基づく総推力算出
- [x] **重量計算**: 全モジュールの重量を合計（基本機体重量 + 各モジュール重量）
- [x] **設計有効性判定**: 推力 ≥ 重量で飛行可能かどうかを判定
- [x] **視覚的フィードバック**: 緑色/赤色のカラーコーディング、推力/重量比のプログレスバー
- [x] **リアルタイムプレビュー**: モジュール選択時の即座な推力バランス更新
- [x] **設計制限**: 推力不足時の保存/装備ボタン無効化
- [x] **警告システム**: 推力不足時の改善提案メッセージ

### HOI4準拠エアフレームシステム（NEW！）
- [x] **機体サイズ**: 軽戦航空機、中航空機、大型航空機（エンジン数1/2/4）
- [x] **技術世代**: 初期型、基本型、改良型、先進型（1936-1945+、性能・コスト修正）
- [x] **主兵装による役割決定**: 
  - 軽戦航空機: 機関銃→戦闘機、爆弾→急降下爆撃機、魚雷→艦上戦闘機
  - 中航空機: 機関銃→重戦闘機、爆弾→戦術爆撃機、魚雷→攻撃機
  - 大型航空機: 爆弾→戦略爆撃機、魚雷→哨戒機
- [x] **エアフレーム選択UI**: 段階的選択（サイズ→世代→確定）
- [x] **動的役割表示**: 主兵装選択に応じたリアルタイム役割更新
- [x] **制限システム**: エアフレームごとの武器タイプ制限

## 🚧 次のチャットで実装予定（優先度順）

### ✅ **リファクタリング実施（完了：スプリント1）** 🔥
**目的**: 巨大化したコンポーネントの分割によるテストと保守性の向上

**完了した改善**:
- ✅ `AircraftDesigner.jsx`の計算ロジックを6つのモジュールに分離
- ✅ 約250行のコード削減、責務の明確化
- ✅ カスタムフック（`useAircraftCalculations`, `useStatsCalculations`, `useAircraftState`）作成
- ✅ ユーティリティ関数（`statsCalculator.js`, `moduleHelpers.js`）分離
- ✅ 基本的な単体テスト作成

**実装済み**: `REFACTORING_ROADMAP.md`のスプリント1完了
- [x] **スプリント1**: 計算ロジックの分離（hooks, utils）
- [ ] **スプリント2**: 統計表示コンポーネント分離
- [ ] **スプリント3**: モジュールUI分離
- [ ] **スプリント4**: 状態管理統合
- [ ] **スプリント5**: サービス層構築
- [ ] **スプリント6**: 共通UI・最終統合

**達成効果**: 
- ✅ テスト作成が可能に（単体テスト実装済み）
- ✅ 計算ロジックの再利用性向上
- ✅ コンポーネントの責務分離
- ✅ 新機能追加の準備完了

### 🔥 **スプリント0 (最優先): TypeScript移行** 🔥🔥🔥
**目的**: JavaScriptからTypeScriptへの全面移行で型安全性と開発効率を大幅向上

**緊急性の理由**:
- 現在のリファクタリングでコンポーネントが小さくなった今がTypeScript化のベストタイミング
- 今後の新機能追加時に型安全性が不可欠
- コンポーネント分割後のインターフェースの明文化が必要

**実装計画**: `REFACTORING_ROADMAP.md`のスプリント0を参照
- [ ] **Day 1**: TypeScript環境セットアップ、コア型定義
- [ ] **Day 2**: ユーティリティ関数の型化 (utils/)
- [ ] **Day 3**: カスタムフックの型化 (hooks/)
- [ ] **Day 4**: メインコンポーネントの型化
- [ ] **Day 5**: データファイルの型化、テストの型化

**期待効果**: 
- ✅ コンパイル時の型チェックでバグの早期発見
- ✅ IDEの強力な自動補完、リファクタリングサポート
- ✅ インターフェースの自動文書化
- ✅ モジュール間の結合度の明確化
- ✅ 新人開発者のオンボーディング高速化

### 0. **TypeScript移行（最優先）** 🔥🔥🔥
**目的**: 型安全性と開発効率の大幅向上、今後の開発基盤の確立

### 1. モジュール数制限システム（高優先度）
**目的**: HOI4準拠の複数モジュール装備を実現

**実装内容**:
- [ ] **複数エンジン装備**: 中航空機でエンジン×2、大型航空機でエンジン×4
- [ ] **複数防衛砲塔**: 戦略爆撃機で防衛砲塔×4まで装備可能
- [ ] **副兵装の複数装備**: 重戦闘機で副兵装×2など
- [ ] **装備スロットUI**: 同一モジュールの複数表示・管理
- [ ] **推力・重量計算**: 複数モジュールの合計値計算

**技術的課題**:
```javascript
// 現在: { engine: 'engine_1' }
// 変更後: { engine: ['engine_1', 'engine_2'] }
// または: { engine_1: 'engine_1', engine_2: 'engine_2' }
```

### 2. HOI4準拠データ値調整（高優先度）
**問題**: 現在の設定値が甘すぎる（エンジンI+重武装が可能）

**調整項目**:
- [ ] **エンジン推力値の削減**: エンジンI: 30kN → 15kN、エンジンII: 50kN → 25kN等
- [ ] **重武装の重量増加**: 大型爆弾: 15t → 25t、魚雷: 1-3t → 5-8t等
- [ ] **基本機体重量の調整**: より現実的なバランスに
- [ ] **技術世代による性能差**: 世代間の明確な性能差を実現

**参考データ（実装時に使用）**:
```javascript
// より厳しいバランス例
const balancedEngines = {
  engine_1: { thrust: 12, weight: 4 },  // 基本的な戦闘機のみ
  engine_2: { thrust: 20, weight: 6 },  // 軽爆撃可能
  engine_3: { thrust: 35, weight: 9 },  // 重戦闘機・戦術爆撃機
  engine_4: { thrust: 50, weight: 12 }  // 最高性能
};
```

### 3. 研究・生産コストシステム（中優先度）
- [ ] **研究コスト**: 技術世代×モジュール組み合わせによる研究ポイント
- [ ] **生産コスト**: 装備重量・複雑さによる工場日数
- [ ] **戦略資源**: アルミニウム、タングステン、ゴム等の消費
- [ ] **コスト最適化UI**: コスト効率の可視化

### 4. プリセット管理機能（中優先度）
- [ ] **設計保存**: JSON形式での設計データ保存
- [ ] **プリセット一覧**: 保存済み設計の管理・比較
- [ ] **エクスポート機能**: 設計データの共有
- [ ] **お気に入り機能**: よく使う設計のブックマーク

### 5. 高度なUI改善（低優先度）
- [ ] **アニメーション強化**: モジュール装着時の滑らかな遷移
- [ ] **3D機体モデル**: エアフレーム別の立体表示
- [ ] **モバイル対応**: レスポンシブデザインの完全対応
- [ ] **ダークモード改善**: より精密なHOI4カラーリング

## 📋 次のチャット開始時の状況

### 現在の実装状況
- ✅ HOI4準拠のエアフレームシステム完全実装済み
- ✅ 推力vs重量システム動作中
- ⚠️ データ値が甘すぎる（要調整）
- ❌ モジュール数制限未実装（単一装備のみ）

### 技術的な引き継ぎ事項

**ファイル構造**:
```
src/
├── components/
│   ├── AircraftDesigner.jsx (メイン統合コンポーネント)
│   ├── AirframeSelectionScreen.jsx (HOI4準拠選択画面)
│   ├── MainDesignScreen.jsx (設計メイン画面)
│   └── modules/
│       ├── ModuleSelectionScreen.jsx
│       └── WeaponTypeSelectionScreen.jsx
├── data/
│   ├── airframes/
│   │   └── airframeTypes.js (HOI4準拠エアフレームデータ)
│   ├── modules/ (各モジュールデータ)
│   └── module.js (統合モジュールデータ)
```

**重要な実装済み機能**:
1. `getAircraftRole(airframe, weaponType)` - 主兵装による役割決定
2. `calculateThrustAndWeight()` - 推力vs重量計算
3. `isWeaponTypeAllowed()` - エアフレーム制限チェック
4. 段階的エアフレーム選択UI（サイズ→世代→確定）

**次のチャットで最初に取り組むべき課題**:
1. **モジュール数制限システムの設計・実装**
2. **データ値の大幅調整**（推力・重量バランス）
3. **複数エンジン装備のUI設計**

### 参考：実際のHOI4バランス
- 軽戦航空機: エンジン×1で軽武装のみ可能
- 中航空機: エンジン×2で中程度の武装可能
- 大型航空機: エンジン×4で重武装・複数砲塔可能
- 推力不足は頻繁に発生し、エンジン強化が必要

---

**最終目標**: 完全なHOI4準拠の航空機設計システム - プレイヤーが実際のゲームと同じ感覚で戦略的な設計選択を行えるアプリケーション
